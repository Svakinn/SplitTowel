define(["durandal/system","durandal/binder","knockout"],function(e,t,i){function n(e){var t=e[0];return"_"===t||"$"===t}function r(t){return!(!t||void 0===t.nodeType||!e.isNumber(t.nodeType))}function o(e){if(!e||r(e)||e.ko===i||e.jquery)return!1;var t=f.call(e);return-1==v.indexOf(t)&&!(e===!0||e===!1)}function a(e,t){var i=e.__observable__,n=!0;if(!i||!i.__full__){i=i||(e.__observable__={}),i.__full__=!0,p.forEach(function(i){e[i]=function(){n=!1;var e=y[i].apply(t,arguments);return n=!0,e}}),h.forEach(function(i){e[i]=function(){n&&t.valueWillMutate();var r=m[i].apply(e,arguments);return n&&t.valueHasMutated(),r}}),g.forEach(function(i){e[i]=function(){for(var r=0,o=arguments.length;o>r;r++)s(arguments[r]);n&&t.valueWillMutate();var a=m[i].apply(e,arguments);return n&&t.valueHasMutated(),a}}),e.splice=function(){for(var i=2,r=arguments.length;r>i;i++)s(arguments[i]);n&&t.valueWillMutate();var o=m.splice.apply(e,arguments);return n&&t.valueHasMutated(),o};for(var r=0,o=e.length;o>r;r++)s(e[r])}}function s(t){var r,s;if(o(t)&&(r=t.__observable__,!r||!r.__full__)){if(r=r||(t.__observable__={}),r.__full__=!0,e.isArray(t)){var c=i.observableArray(t);a(t,c)}else for(var u in t)n(u)||r[u]||(s=t[u],e.isFunction(s)||l(t,u,s));b&&e.log("Converted",t)}}function c(e,t,i){var n;e(t),n=e.peek(),i?n?n.destroyAll||a(n,e):(n=[],e(n),a(n,e)):s(n)}function l(t,n,r){var o,l,u=t.__observable__||(t.__observable__={});if(void 0===r&&(r=t[n]),e.isArray(r))o=i.observableArray(r),a(r,o),l=!0;else if("function"==typeof r){if(!i.isObservable(r))return null;o=r}else e.isPromise(r)?(o=i.observable(),r.then(function(t){if(e.isArray(t)){var n=i.observableArray(t);a(t,n),t=n}o(t)})):(o=i.observable(r),s(r));return Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:o,set:i.isWriteableObservable(o)?function(t){t&&e.isPromise(t)?t.then(function(t){c(o,t,e.isArray(t))}):c(o,t,l)}:void 0}),u[n]=o,o}function u(t,n,r){var o,a={owner:t,deferEvaluation:!0};return"function"==typeof r?a.read=r:("value"in r&&e.error('For defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof r.get&&e.error('For defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),a.read=r.get,a.write=r.set),o=i.computed(a),t[n]=o,l(t,n,o)}var d,f=Object.prototype.toString,v=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],p=["remove","removeAll","destroy","destroyAll","replace"],h=["pop","reverse","sort","shift","splice"],g=["push","unshift"],m=Array.prototype,y=i.observableArray.fn,b=!1;return d=function(e,t){var n,r,o;return e?(n=e.__observable__,n&&(r=n[t])?r:(o=e[t],i.isObservable(o)?o:l(e,t,o))):null},d.defineProperty=u,d.convertProperty=l,d.convertObject=s,d.install=function(e){var i=t.binding;t.binding=function(e,t,n){n.applyBindings&&!n.skipConversion&&s(e),i(e,t)},b=e.logConversion},d});